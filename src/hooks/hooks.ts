import { TypedUseSelectorHook, useDispatch, useSelector } from "react-redux";
import { AppDispatch, RootSlice } from "../app/store";
import seedrandom from "seedrandom";


export const useAppDispatch: () => AppDispatch = useDispatch;
export const useAppSelector: TypedUseSelectorHook<RootSlice> = useSelector


const randomaizer = () => {
  const seed = `${new Date().getTime()}${Math.random()}`
  const rng = seedrandom(seed)
  return rng()
}

export const getMinesArray = (minesCount: number, totalTiles: number = 25): number[] => {
  const allTileIndices = Array.from({length: 25}, (_, i) => i);
  const minesArray: number[] = [];
  for (let i = 0; i < minesCount; i++) {
    const randomIndex = Math.floor(Number(randomaizer()) * allTileIndices.length);
    const mineIndex = allTileIndices.splice(randomIndex, 1)[0];
    minesArray.push(mineIndex)
  }
return minesArray
}

type MultiplierData = {
  [key: string]: { [key: number]: number };
};


const MULTIPLIERS_DATA: MultiplierData = {
  "1": {
    "1": 0.73, "2": 0.76, "3": 0.8, "4": 0.83, "5": 0.88, "6": 0.92, "7": 0.97, "8": 1.03, "9": 1.09, "10": 1.17, "11": 1.25, "12": 1.35, "13": 1.46, "14": 1.59, "15": 1.75, "16": 1.94, "17": 2.19, "18": 2.5, "19": 2.92, "20": 3.5, "21": 4.38, "22": 5.83, "23": 8.75, "24": 17.5
  },
  "2": {
    "1": 0.76, "2": 0.83, "3": 0.91, "4": 1.0, "5": 1.11, "6": 1.23, "7": 1.37, "8": 1.54, "9": 1.75, "10": 2.0, "11": 2.31, "12": 2.69, "13": 3.18, "14": 3.82, "15": 4.67, "16": 5.83, "17": 7.5, "18": 10.0, "19": 14.0, "20": 21.0, "21": 35.0, "22": 70.0, "23": 210.0
  },
  "3": {
    "1": 0.8, "2": 0.91, "3": 1.05, "4": 1.21, "5": 1.41, "6": 1.66, "7": 1.97, "8": 2.37, "9": 2.87, "10": 3.54, "11": 4.42, "12": 5.63, "13": 7.32, "14": 9.76, "15": 13.42, "16": 19.17, "17": 28.75, "18": 46.0, "19": 80.5, "20": 161.0, "21": 402.5, "22": 1610.0
  },
  "4": {
    "1": 0.83, "2": 1.0, "3": 1.21, "4": 1.48, "5": 1.83, "6": 2.28, "7": 2.89, "8": 3.72, "9": 4.87, "10": 6.49, "11": 8.85, "12": 12.38, "13": 17.89, "14": 26.83, "15": 42.17, "16": 70.28, "17": 126.5, "18": 253.0, "19": 590.33, "20": 1771.0, "21": 8855.0
  },
  "5": {
    "1": 0.88, "2": 1.11, "3": 1.41, "4": 1.83, "5": 2.4, "6": 3.2, "7": 4.34, "8": 6.01, "9": 8.51, "10": 12.38, "11": 18.58, "12": 28.9, "13": 46.96, "14": 80.5, "15": 147.58, "16": 295.17, "17": 664.12, "18": 1771.0, "19": 6198.5, "20": 37191.0
  },
  "6": {
    "1": 0.92, "2": 1.23, "3": 1.66, "4": 2.28, "5": 3.2, "6": 4.57, "7": 6.68, "8": 10.02, "9": 15.48, "10": 24.77, "11": 41.28, "12": 72.24, "13": 134.17, "14": 268.33, "15": 590.33, "16": 1475.83, "17": 4427.5, "18": 17710.0, "19": 123970.0
  },
  "7": {
    "1": 0.97, "2": 1.37, "3": 1.97, "4": 2.89, "5": 4.34, "6": 6.68, "7": 10.57, "8": 17.3, "9": 29.41, "10": 52.29, "11": 98.04, "12": 196.09, "13": 424.86, "14": 1019.67, "15": 2804.08, "16": 9346.94, "17": 42061.25, "18": 336490.0
  },
  "8": {
    "1": 1.03, "2": 1.54, "3": 2.37, "4": 3.72, "5": 6.01, "6": 10.02, "7": 17.3, "8": 31.14, "9": 58.83, "10": 117.65, "11": 252.12, "12": 588.27, "13": 1529.5, "14": 4588.5, "15": 16824.5, "16": 84122.5, "17": 757102.5
  },
  "9": {
    "1": 1.09, "2": 1.75, "3": 2.87, "4": 4.87, "5": 8.51, "6": 15.48, "7": 29.41, "8": 58.83, "9": 125.01, "10": 285.73, "11": 714.33, "12": 2000.12, "13": 6500.38, "14": 26001.5, "15": 143008.25, "16": 1430082.5
  },
  "10": {
    "1": 1.17, "2": 2.0, "3": 3.54, "4": 6.49, "5": 12.38, "6": 24.77, "7": 52.29, "8": 117.65, "9": 285.73, "10": 761.95, "11": 2285.85, "12": 8000.46, "13": 34668.67, "14": 208012.0, "15": 2288132.0
  },
  "11": {
    "1": 1.25, "2": 2.31, "3": 4.42, "4": 8.85, "5": 18.58, "6": 41.28, "7": 98.04, "8": 252.12, "9": 714.33, "10": 2285.85, "11": 8571.92, "12": 40002.31, "13": 260015.0, "14": 3120180.0
  },
  "12": {
    "1": 1.35, "2": 2.69, "3": 5.63, "4": 12.38, "5": 28.9, "6": 72.24, "7": 196.09, "8": 588.27, "9": 2000.12, "10": 8000.46, "11": 40002.31, "12": 280016.15, "13": 3640210.0
  },
  "13": {
    "1": 1.46, "2": 3.18, "3": 7.32, "4": 17.89, "5": 46.96, "6": 134.17, "7": 424.86, "8": 1529.5, "9": 6500.38, "10": 34668.67, "11": 260015.0, "12": 3640210.0
  },
  "14": {
    "1": 1.59, "2": 3.82, "3": 9.76, "4": 26.83, "5": 80.5, "6": 268.33, "7": 1019.67, "8": 4588.5, "9": 26001.5, "10": 208012.0, "11": 3120180.0
  },
  "15": {
    "1": 1.75, "2": 4.67, "3": 13.42, "4": 42.17, "5": 147.58, "6": 590.33, "7": 2804.08, "8": 16824.5, "9": 143008.25, "10": 2288132.0
  },
  "16": {
    "1": 1.94, "2": 5.83, "3": 19.17, "4": 70.28, "5": 295.17, "6": 1475.83, "7": 9346.94, "8": 84122.5, "9": 1430082.5
  },
  "17": {
    "1": 2.19, "2": 7.5, "3": 28.75, "4": 126.5, "5": 664.12, "6": 4427.5, "7": 42061.25, "8": 757102.5
  },
  "18": {
    "1": 2.5, "2": 10.0, "3": 46.0, "4": 253.0, "5": 1771.0, "6": 17710.0, "7": 336490.0
  },
  "19": {
    "1": 2.92, "2": 14.0, "3": 80.5, "4": 590.33, "5": 6198.5, "6": 123970.0
  },
  "20": {
    "1": 3.5, "2": 21.0, "3": 161.0, "4": 1771.0, "5": 37191.0
  },
  "21": {
    "1": 4.38, "2": 35.0, "3": 402.5, "4": 8855.0
  },
  "22": {
    "1": 5.83, "2": 70.0, "3": 1610.0
  },
  "23": {
    "1": 8.75, "2": 210.0
  },
  "24": {
    "1": 17.5
  }
};

interface TileState {
  isRevealed: boolean,
  hasMine: boolean,
}


export const getMultipliers = (board : TileState[], mines: number, gameMode: string, selectedTiles: number = 0) : {current: number, next: number} =>  {
  if(gameMode === 'Manual') {
    const openTiles = board.filter(item => item.isRevealed).length;
    
  
    const currentMultiplier = openTiles > 0 ? MULTIPLIERS_DATA[mines][openTiles] : 0;
    
    
    const nextMultiplier = MULTIPLIERS_DATA[mines][openTiles + 1];

    return {
      current: currentMultiplier,
      next: nextMultiplier,
    };

  } else {
    const openTiles = selectedTiles;
    const currentMultiplier = openTiles > 0 ? MULTIPLIERS_DATA[mines][openTiles] : 0;
    const nextMultiplier = MULTIPLIERS_DATA[mines][openTiles + 1];
    return {
      current: currentMultiplier,
      next: nextMultiplier,
    };
  }

    
  };